# 三、数据链路层

## 数据链路层基础概论

### 数据链路层概念

- 数据链路层是在物理层和网络层之间的协议，提供相邻结点的可靠数据传输。

### 帧的概念

- 数据链路层的协议数据单元
- 组成

	- 帧头

		- 源MAC地址、目的MAC地址、类型

	- 数据
	- 帧尾

		- 校验

### 以太网数据帧中的MAC和LLC

- MAC

	- MAC介质访问控制，对接物理层（下层）
	- 作用

		- 数据帧的封装/卸装，帧的寻址和识别，帧的接收与发送，链路的管理，帧的差错控制等。MAC子层的存在屏蔽了不同物理链路种类的差异性。

- LLC

	- LLC逻辑控制访问，对接网络层（上层）
	- 作用

		- LLC子层的主要功能为传输可靠性保障和控制，数据包的分段与重组，数据包的顺序传输。

- 注解

	- 该协议位于OSI七层协议中数据链路层，数据链路层分为上层LLC（逻辑链路控制），和下层的MAC（媒体访问控制），MAC主要负责控制与连接物理层的物理介质。在发送数据的时候，MAC协议可以事先判断是否可以发送数据，如果可以发送将给数据加上一些控制信息，最终将数据以及控制信息以规定的格式发送到物理层；在接收数据的时候，MAC协议首先判断输入的信息并是否发生传输错误，如果没有错误，则去掉控制信息发送至LLC（逻辑链路控制）层。

### 数据链路层的两种传输方式

- 单播
- 广播

### 数据链路层的三个基本问题

- 封装成帧

	- 封装成帧就是在一段数据的前后分别添加首部和尾部，这样就构成了一个帧，接收端在收到物理层上交的比特流后，就能根据首部和尾部的标记，从收到的比特流中识别帧的开始和结束。

- 透明传输

	- 透明传输是指不管所传数据是什么样的比特组合，都应当能够在链路上传送。

- 差错检测

	- 收到正确的帧就要向发送端发送确认，发送端在一定的期限内若没有收到对方的确认，就认为出现了差错，因而就进行重传，直到收到对方的确认为止。

### 以太网中的设备

- 集线器

	- 集线器的英文称为“Hub”。“Hub”是“中心”的意思，集线器的主要功能是对接收到的信号进行再生整形放大，以扩大网络的传输距离，同时把所有节点集中在以它为中心的节点上。

- 交换机（每个接口是一个冲突域，所有接口组成广播域）

	- 交换机（Switch）意为“开关”是一种用于电（光）信号转发的网络设备。它可以为接入交换机的任意两个网络节点提供独享的电信号通路。最常见的交换机是以太网交换机。

- 网桥

	- 两个端口的交换机

## 数据链路层的通信协议

### 冲突域和广播域

- 冲突域

	- 交换机的每一个端口都是一个冲突域；冲突域只能发生在一个网段

- 广播域

	- 交换机的所有端口都在一个广播域；广播域在一个或多个网段内发生。

- 区别

	- 1、广播域可以跨网段
2、在冲突域中所有的数据传输都是以广播形式；在广播域中，只有广播帧才会被所有主机接收。
3、冲突域是基于第一层（物理层），而广播域是机于第二层（数据链路层） 。
4、HUB 所有端口都在同一个广播域，冲突域内。Swith所有端口都在同一个广播域内，而每一个端口就是一个冲突域。

### 虚拟局域网（实验）

- VLAN（Virtual Local Area Network）即虚拟局域网，是将一个物理的LAN在逻辑上划分成多个广播域的通信技术。VLAN内的主机间可以直接通信，而VLAN间不能直接通信，从而将广播报文限制在一个VLAN内。
- 优点和目的

	- 1.划分广播域
	- 2.增强局域网的安全性
	- 3.提高健壮性
	- 4.灵活构建工作组

- 划分VLAN的方式

	- 基于端口

		- 给交换机的每个接口配置不同的PVID，当一个数据帧进入交换机接口时，如果没有带VLAN标签，且该接口上配置了PVID，那么，该数据帧就会被打上接口的PVID。如果进入的帧已经带有VLAN标签，那么交换机不会再增加VLAN标签，即使接口已经配置了PVID。

			- Access

				- 只允许通过一个VLAN

			- Trunk

				- 允许通过多个VLAN

			- hybird

	- 基于子网

		- 配置好子网与VLAN映射表，如果交换设备收到的是untagged（不带VLAN标签）帧，交换设备根据报文中的源IP地址信息，确定添加的VLAN ID。将指定网段或IP地址发出的报文在指定的VLAN中传输，减轻了网络管理者的任务量，且有利于管理。

	- 基于MAC地址

		- 先配置好MAC地址和VLAN ID映射关系表，当终端用户的物理位置发生改变，不需要重新配置VLAN。提高了终端用户的安全性和接入的灵活性。

	- 基于协议

		- 将网络中提供的服务类型与VLAN相绑定，方便管理和维护。需要对网络中所有的协议类型和VLAN ID的映射关系表进行初始配置。需要分析各种协议的地址格式并进行相应的转换，消耗交换机较多的资源，速度上稍具劣势。

	- 基于匹配策略

		- 先在交换机上配置好终端的MAC地址和IP地址，并与VLAN关联。只有符合条件的终端才能加入指定VLAN。符合策略的终端加入指定VLAN后，严禁修改IP地址或MAC地址，否则会导致终端从指定VLAN中退出。

### CSMA/CD

- CSMA/CD即载波侦听多路访问/冲突检测，是广播型信道中采用一种随机访问技术的竞争型访问方法，具有多目标地址的特点。总线型网络传输数据

	- 总线型网络

- 四大要点

	- 1.先听再发
	- 2.边听边发
	- 3.冲突停止
	- 4.延迟后发

- 三大：多点接入，载波监听，碰撞检测

### PPP

- 点对点通信是一对一信道，因此不会发生碰撞，因此比较简单，采用PPP协议；其中PPP协议就是用户计算机和ISP(互联网服务提供商)进行通信时使用的数据链路层的协议
- PPP 最初设计是为两个对等节点之间的 IP 流量传输提供一种封装协议。

### CRC

- 循环冗余校验
- 是数据通信领域中最常用的一种查错校验码，其特征是信息字段和校验字段的长度可以任意选定。循环冗余检查（CRC）是一种数据传输检错功能，对数据进行多项式计算，并将得到的结果附在帧的后面，接收设备也执行类似的算法，以保证数据传输的正确性和完整性。
