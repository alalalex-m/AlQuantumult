##### 15.一个3200位长的TCP报文传到IP层，加上160位的首部后成为数据报。下面的互联网由两个局域网通过路由器连接起来。但第二个局域网所能传送的最长数据帧中的数据部分只有1200位。因此数据报在路由器必须进行分片。试问第二个局域网向其上层要传送多少比特的数据（这里的“数据”当然指的是局域网看见的数据）?

解：第二个局域网所能传送的最大数据帧中的数据只有 1200 bit，可见每一个IP数据报的最大长度是1200bit，故其数据部分最多为：
IP数据报的总长度 - IP数据报的首部 = 1200 - 160 = 1040 bit
而 TCP 交给 IP 的数据共 3200 bit = 1040 + 1040 +1040 + 80，因此 3200 bit 的数据必须划分为 4 个数据报片
四个数据报片的首部均为 160 bit（但里面内容并不相同），这四个数据报片的总长度（首部加上数据部分）分别为 1200 bit，1200 bit，1200 bit 和 240 bit。
上面这些就是第二个局域网向其上层传送的数据。
因此，第二个局域网向上传送 1200 + 1200 + 1200 + 240 = 3840 bit。

##### 18.设某路由器建立了如下路由表： 

目的网络-------------------下一跳 
192.4.153.0/26--------------R3
128.96.39.0/25-------------接口m0 
128.96.39.128/25---------接口m1 
128.96.40.0/25-------------R2 
192.4.153.0/26-------------R3
（默认）--------------------R4  

##### 现共收到5个分组，其目的地址分别为： 

（1）128.96.39.10 
（2）128.96.40.12 
（3）128.96.40.151 
（4）192.4.153.17 
（5）192.4.153.90 

##### 试分别计算下一跳。

解：

这里一共给出了两种目的网络，即子网掩码是255.255.255.128。还有子网掩码是255.255.255.192的。这里首先将目的地址与子网掩码255.255.255.128进行相与得出的结果则是目的网络的IP码，如果没用得到相对应得下一跳，再与子网掩码255.255.255.19进行相与得出目的网络的码，进行路由表对照即可。相与(将目的地址与子网掩码都化为二进制表示，然后进行相与即and,两数都为1时输出1，否则输出0)。这里感谢粉丝天师物联网的帮助！

(1)分组的目的地址为：128.96.39.10先与子网掩码255.255.255.128相与得128.96.39.0，由路由表对照，则下一跳接口为m0。
(2)分组的目的地址为：128.96.40.12先与子网掩码255.255.255.128相与得128.96.40.0，由路由表对照，则下一跳接口为R2。
(3)分组的目的地址为：128.96.40.151先与子网掩码255.255.255.128相与得
128.96.40.128，由路由表对照，则下一跳接口R4。
(4)分组的目的地址为：192.4.153.17先与子网掩码255.255.255.192相与得192.4.153.0，由路由表对照，则下一跳接口R3。
(5)分组的目的地址为：192.4.153.90与子网掩码255.255.255.192相与得192.4.153.64，经查路由表知，该分组转发选择默认路由，则下一跳接口为R4。

##### 19.某单位分配到一个地址块为129.250/16。该单位有4000台机器，分布在16个不同的地点。试给每一个地点分配一个地址块，并算出每个地址块中IP地址的最小值和最大值。

解：4000台机器，16个地点，即每个地点有250个主机，根据地址块129.250/16，我们可以得知用16位表示主机号，其中后八位就有256-2=254个主机号，所以250个完全够用。即从答案如下：
地点： 子网号-----------子网网络号---------IP最小值---------IP最大值

1： 00000001---------129.250.1.0-------129.250.1.1-------129.250.1.254

2： 00000010---------129.250.2.0-------129.250.2.1-------129.250.2.254

3： 00000011---------129.250.3.0-------129.250.3.1-------129.250.3.254

4： 00000100---------129.250.4.0-------129.250.4.1-------129.250.4.254

5： 00000101---------129.250.5.0-------129.250.5.1-------129.250.5.254

6： 00000110---------129.250.6.0-------129.250.6.1-------129.250.6.254

7： 00000111---------129.250.7.0--------129.250.7.1-------129.250.7.254

8： 00001000---------129.250.8.0--------129.250.8.1-------129.250.8.254

9： 00001001---------129.250.9.0--------129.250.9.1-------129.250.9.254

10： 00001010---------129.250.10.0--------129.250.10.1------129.250.10.254

11： 00001011---------129.250.11.0--------129.250.11.1-------129.250.11.254

12： 00001100---------129.250.12.0--------129.250.12.1-------129.250.12.254

13： 00001101---------129.250.13.0--------129.250.13.1-------129.250.13.254

14： 00001110---------129.250.14.0--------129.250.14.1-------129.250.14.254

15： 00001111---------129.250.15.0--------129.250.15.1-------129.250.15.254

16： 00010000---------129.250.16.0--------129.250.16.1------129.250.16.254

##### 20.一个数据报长度为4000字节（固定首部长度）。现在经过一个网络传送，但此网络能够传送的最大数据长度为1500字节。试问应当划分为几个短些的数据报片？各数据报片的数据字段长度、片偏移字段和MF标志应为何数值？

解：这里需要注意到一个问题就是 IP数据报固定首部长度为20字节。解释MF标志字段中的最低位为MF（More Fragment）。MF=1即表示后面还有分片的数据报。MF=0表示这已是若干数据报片中最后一个。片偏移量为8个字节为一个单位
首先是4000个字节，而网络能够传送的最大数据长度为1500字节，所以最少需要分成3段。
总长度----------数据字段长度----------MF----------片偏移字段
1500----------------1480-------------------1-------------0/8=0
1500----------------1480-------------------1-------------1480/8=185
1040----------------1020-------------------0-------------(1480+1480)/8=370

##### 22.有如下的4个/24地址块，试进行最大可能的聚合。

212.56.132.0/24
212.56.133.0/24
212.56.134.0/24
212.56.135.0/24
解：通俗的解释一下聚合，就是取两个地址块前缀相同的部分。把数全部化为2进制然后进行比较。
212=11010100
56=00111000
132=10000100
133=10000101
134=10000110
135=10000111
则4个地址块有22个相同的前缀，则聚合之后的CIDR地址为：212.56.132.0/22

##### 24.已知路由器R1的转发表如下表所示。试画出各网络和必要的路由器的连接拓扑，标注出必要的IP地址和接口，对不能确定的情况应当指明。

前缀匹配	下一跳地址	路由器接口
140.5.12.64/26	180.15.2.5	m2
130.5.8/24	190.16.6.2	m1
110.71/16	…	m0
180.15/16	…	m2
190.16/16	…	m1
默认	110.71.4.5	m0
答：

##### 26.一个大公司有一个总部和三个下属部门。公司分配到的网络前缀是192.77.33/24。公司的网络布局如图所示。总部共有5个局域网,其中的LAN1到LAN4都连接到路由器R1上,R1再通过LAN5与路由器R2相连。R2和远地的三个部门的局域网LAN6到LAN8通过广域网相连。每一个局域网旁边表明的字是局域网上的主机数。试给出每一个局域网分配一个合适的网络前缀。

答:本题和25几乎相同,所以不做过多解释,看你留得主机位够不够你所需的主机数就可以了。
LAN1:192.77.33.0/26
LAN2:192.77.33.192/28
LAN3:192.77.33.64/27
LAN4:192.77.33.208/28
LAN5:192.77.33.224/29
LAN6:192.77.33.128/27
LAN7:192.77.33.192/27
LAN8:192.77.33.224/27

##### 28.以下的地址前缀中哪一个地址与2.52.90.140匹配?请说明理由。(1) 0/4;(2)32/4;(3)4/6;(4)80/4。

答:本题和27题相似,这里前缀有4位和六位,题目中的地址第一个数为2,所以无论前缀是4还是6,都应该全为0,所以(1)符合要求。

##### 29.以下的地址前缀的哪一个和地址152.7.77.159及152.31.47.252都匹配?请说明理由。(1)152.40/13;(2)153.40/9;(3)152.64/12;(4)152.0/11。

答:这题首先需要先找这两个地址的相同的网络前缀为152.所以只有(4)符合要求。

##### 31.已知地址块中的一个地址是140.120.84.24/20。试求这个地址块中的最小地址和最大地址。地址掩码是什么？地址块中共有多少个地址？相当于多少个C类地址？

答：因为CIDR没有A类、B类、C类的地址划分概念，IP地址由网络前缀的主机号组成，/20表示网络前缀有20位，剩下的就是主机号。
140.120.84.24/20转换为二进制是：10001100.01111000.01010100.00000000。黑体部分为网络前缀，所以只有主机号可以变。
最小地址为：140.120.80.0/20
最大地址为：140.120.95.255/20
地址掩码为：11111111.11111111.11110000.00000000(这里就是网络位变为1，主机位为0)
一共有2 1 2 2^122 

 2^1=4096个地址。相当于16个C类地址。

##### 33.某单位分配到一个地址块136.23.12.64/26。现在需要进一步划分为4个一样大的子网。试问:

(1）每一个子网的网络前缀有多长？
(2）每一个子网中有多少个地址？
(3）每一个子网的地址是什么？
(4）每一个子网可分配给主机使用的最小地址和最大地址是什么？
答：(1)每个子网前缀需要28位，才能平均划分为4个一样大的子网。
(2)每个子网的地址中有4位留给主机用，因此共有16个地址。
(3)四个子网的地址块是：
(4)每一个子网可分配的最小地址和最大地址为：
第一个地址块136.23.12.64/28，可分配给主机使用的
最小地址：136.23.12.01000001＝136.23.12.65/28
最大地址：136.23.12.01001110＝136.23.12.78/28
第二个地址块136.23.12.80/28，可分配给主机使用的
最小地址：136.23.12.01010001＝136.23.12.81/28
最大地址：136.23.12.01011110＝136.23.12.94/28
第三个地址块136.23.12.96/28，可分配给主机使用的
最小地址：136.23.12.01100001＝136.23.12.97/28
最大地址：136.23.12.01101110＝136.23.12.110/28
第四个地址块136.23.12.112/28，可分配给主机使用的
最小地址：136.23.12.01110001＝136.23.12.113/28
最大地址：136.23.12.01111110＝136.23.12.126/28

##### 37.假定网络中得路由器B的路由表有如下项目。

目的网络	距离	下一跳路由器
N1	7	A
N2	2	C
N6	8	F
N8	4	E
N9	4	F
现在B收到从C发来的路由信息如下表。

目的网络	距离
N2	4
N3	8
N6	4
N8	3
N9	5
试求出路由器B更新后的路由表详细说明每一个步骤
答：先把B收到的路由信息中距离都加1，并且在后面添加C得新表：

目的网络	距离	下一跳路由器
N2	5	C
N3	9	C
N6	5	C
N8	4	C
N9	6	C
然后进行对比新表和B表的”目的网络“和”距离“。

目的网络	距离	下一跳路由器	变化情况
N1	7	A	无新信息，不改变。
N2	5	C	相同下一跳，更新。
N3	9	C	新的项目。添加进来。
N6	5	C	不同下一跳，距离更短，更新。
N8	4	E	不同下一跳，距离一样，不改变。
N9	4	F	不同下一跳，距离更大，不改变。

##### 38.如图所示。假定AS1和AS4运行程序RIP，AS2和AS3运行程序OSPF。AS之间运行程序eBGP和iBGP。目前先假定在AS2和AS4之间没有物理连接(图中的虚线表示这个假定)。


(1)路由器R3c使用哪一个协议知到前缀X(X在AS4中)?
(2)路由器R3a使用哪一个协议知到前缀X？
(3)路由器R1c使用哪一个协议知到前缀X？
(4)路由器R1d使用哪一个协议知到前缀X？
答：(1)eBGP
(2)iBGP
(3)eBGP
(4)iBGP

##### 39.网络同上题。路由器R1d知道前缀X，并将前缀X写入转发表。(1)试问路由器R1d应当从接口1还是接口2转发分组？请简述理由。
(2)先假定AS2和AS4之间有物理连接。假定路由器R1d知道到达前缀X可以经过AS2，但也可以经过AS3。试问路由器R1d应当从接口1还是接口2转发分组呢？请简述理由。
(3)现假定有另一个AS5处在AS2和AS4之间。假定路由器R1d知道到达前缀X可以经过路由[AS2,AS5,AS4]，但也可以经过路由[AS3,AS4]。试问路由器R1d应当从接口1还是接口2进行分组转发？请简述理由。

答：(1)从接口1进行转发分组。因为要向AS4进行转发，所以如果用接口2的话，路由器之间的转发会变多。
(2)从接口2转发，图中的虚线变为实线，从AS2转发，会节省很多的路由器转发时间和步骤。
(3)从接口1出发，因为多经过一个路由AS5可能会有很多次的路由器转发，会浪费时间。

##### 47.某单位分配到一个地址块14.24.74.0/24。该单位需要用到三个子网，对这三个子地址块的具体要求是：子网N1需要120个地址，子网N2需要60个地址，子网N3需要10个地址。请给出地址块的分配方案。

起始地址为 14.24.74.0/24 的地址块，它代表前三个字节为网络前缀（网络号）。最佳方案是分配网络前缀时应先分配地址数较多的前缀。
子网 N1 需要120个地址（台主机）。2n-2≥120，取n=7，即取地址的最后7位为主机地址。于是地址块为14.24.74.0/25（14.24.74.00000000是一个网络地址，即14.24.74.0为最小地址），有效地址范围为14.24.74.1～14.24.74.126， 14.24.74.127/25是子网 N1的 广播地址（最后8位是0111 1111）。
剩下的地址中还有14.24.74.128/25（14.24.74.10000000）没有分配。
子网 N2需要60个地址。2n-2≥60，取n=6，即取地址的最后6位为主机地址。于是地址块为14.24.74.128/26（14.24.74.10000000是一个网络地址，即14.24.74.128为最小地址），有效地址范围为14.24.74.129～14.24.74.190， 14.24.74.191/26是子网 N2的 广播地址（最后8位是1011 1111）。
剩下的地址中还有14.24.74.192/26（14.24.74.11000000）没有分配。
子网 N3 需要 10 个地址。2n-2≥10，取n=4，即取地址的最后4位为主机地址。于是地址块为14.24.74.192/28（14.24.74.1100*0000是一个网络地址，即14.24.74.192为最小地址），有效地址范围为14.24.74.193～14.24.74.206， 14.24.74.207/28是子网 N3的 广播地址（最后8位是1100 1111）。



##### 48.如图所示，网络145.13.0.0/16划分为四个子网N1，N2，N3，N4。四个子网与路由器R连接的接口分别是m0，m1，m2，m3。路由器R的第五个接口m4连接到互联网。

(1)试给出路由器R的路由表。
(2)路由器R收到一个分组，其目的地址是145.13.160.78。试给出这个分组是怎样被转发的。
答：(1)

网络前缀	下一跳
145.13.0.0/18	直接交付，接口m0
145.13.64.0/18	直接交付，接口m1
145.13.128.0/18	直接交付，接口m2
145.13.192.0/18	直接交付，接口m3
0.0.0.0/0	默认路由器，接口m4
(2)查看路由表属于网络前缀为145.13.128.0/18，所以收到的分组直接交给接口m2进行转发。

##### 63.如图所示(1)假定路由器R1把所有发往网络前缀123.1.2.16/29的分组都从接口4转发出去。
(2)假定路由器R1要把H1发往123.1.2.16/29的分组从接口4转发出去。而把H2发往123.1.2.16/29的分组从接口3转发出去。
试问，在上述两种情况下，你都能够给出路由器R1的转发表么？转发表只需要给出发往123.1.2.16/29的分组应当从哪一个接口转发出去。

答：(1)

网络前缀	转发接口
123.1.2.16/29	接口4
(2)根据题目中的条件，无法判断出路由器从接口3还是接口4进行转发，所以无法给出路由表。

##### 66.如图是一个SDN OpenFlow网络。假定：(1)任何来自H5或者H6并到达输入端口1的且发往H1或者H2的分组，应通过端口2转发出去。
(2)任何来自H1或者H2并到达输入端口2的且发往H5或者H6的分组，应通过端口1转发出去。
(3)任何从端口1或者2进入的且发往H3或者H4的分组，应交付指明的主机。
(4)H3或者H4彼此可以互相发送分组。
试给出交换机S2的流表项(每一行的“匹配+动作“)。

答：表格中因为csdn编译器原因，无法打两个*连续的，所以表中出现两个的均为一个。

匹配	动作
入口端=1；IP源地址=10.3.*.**;	转发(2)
入口端=2；IP源地址=10.1.*.**;	转发(1)
入口端=*；IP源地址=10.3…;	转发(3)
入口端=*；IP源地址=10.3…;	转发(4)
入口端=3；IP源地址=10.2.0.3;	转发(4)
入口端=4；IP源地址=10.2.0.4;	转发(3)
…	…

##### 67.SDN OpenFlow 网络同上题。从主机H3或H4发出并到达S2交换机的分组，应遵循以下规则：(1)任何来自H3并到达输入端口2的且发往H1,H2,H5,H6的分组，应顺时针转发出去。(2)任何来自H4并到达输入端口2的且发往H1,H2,H5,H6的分组，应逆时针转发出去。
试给出交换机S2的流表项(匹配+动作)
答：

匹配	动作
入口端=3；IP源地址=10.2.0.3;	转发(2)
入口端=4；IP源地址=10.2.0.4;	转发(1)
…	…