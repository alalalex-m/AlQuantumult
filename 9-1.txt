.MODEL        SMALL
.286
        DATA  SEGMENT
        MES1  DB        'int12!',0DH,0AH,24H
        MES2  DD        MES1
     POINTER  DW        ?
         CNT  DB        9
     INTVECT  DW        ?
      ESVECT  DW        ?
        DATA  ENDS
        CODE  SEGMENT
              ASSUME    CS:CODE,DS:DATA
      START:  CLI
              MOV       AX,DATA
              MOV       DS,AX
              LDS       DX,MES2     ;显示提示信息1
              MOV       AH,09
              INT       21H
              CALL      WRITE_08H    ;设置中断向量
        SSS:  STI
              CMP       BYTE PTR CNT, 0
              JNZ       SSS
              MOV       CNT,9
              JMP       SSS
       
    INT_PROC  PROC      FAR         ;中断程序
              PUSH      AX
              MOV       AL, CNT
              ADD       AL,30H
              MOV       DL,AL
              MOV       AH,02       ;
              INT       21H         ;CNT 显示
              MOV       DL,0DH
              MOV       AH,02       ;
              INT       21H         ;
              MOV       DL,0AH
              MOV       AH,02       ;
              INT       21H         ;回车　换行
              DEC       CNT
              MOV       AL,20H      ;内部8259A中断结束　特殊
              OUT       0A0H,AL
              MOV       AL,20H
              OUT       20H,AL
              POP       AX
              STI
              IRET
    INT_PROC  ENDP

   WRITE_08H  PROC                  ;386 INT=IRQ12   type =74h
              PUSH      DS
              PUSH      AX
              PUSH      DX
              PUSH      ES
       NEXT:
              MOV       AL, 74H
              MOV       AH, 35H
              INT       21H         ; 读原中断信息，如不返回，可不要
              MOV       INTVECT,BX
              MOV       ESVECT,ES
            
              MOV       AX,SEG INT_PROC
              MOV       DS,AX
              MOV       DX, OFFSET INT_PROC
              MOV       AL,74H
              MOV       AH,25H
              INT       21H         ;设置中断向量地址
              IN        AL,0A1H
              OR        AL,00010000B
              OUT       0A1H,AL     ;清IRQ12
              IN        AL,0A1H     ;
              AND       AL, 11101111B           ;置　IRQ12
              OUT       0A1H,AL
              IN        AL,21H
              AND       AL,11111011B            ; 置 主片 IRQ2
              OUT       21H,AL
              POP       ES
              POP       DX
              POP       AX
              POP       DS
              STI                   ;开中断
              RET
   WRITE_08H  ENDP
      
        CODE  ENDS
              END       START